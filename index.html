<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tez Paneli: OKB, IU ve Ruminasyon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; color: #334155; }
        h1, h2, h3, h4, .serif { font-family: 'Merriweather', serif; }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }
        .nav-item.active {
            border-bottom: 2px solid #0F766E; /* Teal-700 */
            color: #0F766E;
            background-color: #F0FDFA;
        }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .hidden-section { display: none; }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center gap-3">
                    <div class="bg-teal-700 text-white p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-slate-800 leading-tight">Tez Araştırma Portalı</h1>
                        <p class="text-xs text-slate-500 font-medium">OKB • Ruminasyon • IU • Bağlanma</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-2">
                    <button onclick="switchTab('overview')" id="nav-overview" class="nav-item active px-4 py-2 rounded-md text-sm font-medium transition-colors">Genel Bakış</button>
                    <button onclick="switchTab('models')" id="nav-models" class="nav-item px-4 py-2 rounded-md text-sm font-medium transition-colors">Tez Modelleri</button>
                    <button onclick="switchTab('library')" id="nav-library" class="nav-item px-4 py-2 rounded-md text-sm font-medium transition-colors">Dijital Kütüphane</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- OVERVIEW SECTION -->
        <section id="overview" class="fade-in space-y-8">
            <!-- Hero Card -->
            <div class="bg-gradient-to-br from-teal-800 to-slate-800 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-white opacity-5"></div>
                <div class="relative z-10 max-w-3xl">
                    <h2 class="text-3xl font-serif font-bold mb-4">Belirsizliğe Tahammülsüzlük ve OKB</h2>
                    <p class="text-slate-200 text-lg mb-6 leading-relaxed">
                        Bu panel, OKB döngüsünde ruminasyon ve belirsizliğe tahammülsüzlüğün (IU) rolünü, bağlanma kuramı ve aile dinamikleriyle birleştiren tez çalışması için hazırlanmıştır.
                    </p>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="switchTab('library')" class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-2.5 rounded-lg font-semibold transition shadow-md">Literatürü İncele</button>
                        <button onclick="switchTab('models')" class="bg-white/10 hover:bg-white/20 text-white border border-white/30 px-6 py-2.5 rounded-lg font-semibold transition backdrop-blur-sm">Hipotezleri Gör</button>
                    </div>
                </div>
            </div>

            <!-- Stats & Analytics Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Stat Cards -->
                <div class="grid grid-cols-2 gap-4 lg:col-span-1">
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center">
                        <div class="text-teal-600 font-bold text-3xl">19</div>
                        <div class="text-xs text-slate-500 font-bold uppercase mt-1">Seçilmiş Makale</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center">
                        <div class="text-indigo-600 font-bold text-3xl">%100</div>
                        <div class="text-xs text-slate-500 font-bold uppercase mt-1">Açık Erişim (OA)</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center col-span-2">
                        <div class="text-rose-600 font-bold text-xl">Transdiagnostik</div>
                        <div class="text-xs text-slate-500 font-bold uppercase mt-1">Yaklaşım Temeli</div>
                        <p class="text-xs text-slate-400 mt-2">IU & Ruminasyon sadece OKB değil, GAD ve Depresyon ile de kesişir.</p>
                    </div>
                </div>

                <!-- Concept Chart -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm lg:col-span-1">
                    <h3 class="text-sm font-bold text-slate-700 uppercase mb-4 tracking-wider">Kavramsal İlişki Ağı</h3>
                    <div class="chart-container" style="height: 200px;">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>

                <!-- Literature Distribution Chart -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm lg:col-span-1">
                    <h3 class="text-sm font-bold text-slate-700 uppercase mb-4 tracking-wider">Literatür Dağılımı</h3>
                    <div class="chart-container" style="height: 200px;">
                        <canvas id="doughnutChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- MODELS SECTION -->
        <section id="models" class="hidden-section fade-in space-y-8">
            <div class="text-center max-w-2xl mx-auto mb-10">
                <h2 class="text-2xl font-bold text-slate-800 serif">Tez İçin Araştırma Rotaları</h2>
                <p class="text-slate-500 mt-2">Literatür taramasından elde edilen verilere dayanarak oluşturulmuş 4 temel hipotez taslağı.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Hypothesis A -->
                <div class="bg-white rounded-xl border-l-4 border-indigo-500 p-6 shadow-sm card-hover">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-indigo-900">Fikir A: Bağlanma ve Bilişsel Zincir</h3>
                        <span class="bg-indigo-50 text-indigo-700 text-xs px-2 py-1 rounded-full font-bold">Temel Model</span>
                    </div>
                    <p class="text-slate-600 text-sm mb-4">Bağlanma kaygısı veya kaçınması, OKB semptomlarını doğrudan değil, <span class="font-semibold text-slate-800">IU ve Ruminasyon</span> üzerinden mi artırıyor?</p>
                    <div class="bg-slate-50 p-3 rounded text-xs text-slate-500 font-mono">
                        Bağlanma (ECR-R) → IU (IUS-12) → Ruminasyon → OKB �?iddeti
                    </div>
                    <div class="mt-4 flex gap-2">
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Marsh (2024)</span>
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">van Leeuwen (2020)</span>
                    </div>
                </div>

                <!-- Hypothesis B -->
                <div class="bg-white rounded-xl border-l-4 border-rose-500 p-6 shadow-sm card-hover">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-rose-900">Fikir B: Aile Uyumlaması (Family Accommodation)</h3>
                        <span class="bg-rose-50 text-rose-700 text-xs px-2 py-1 rounded-full font-bold">Sistemik</span>
                    </div>
                    <p class="text-slate-600 text-sm mb-4">Belirsizliğe tahammülsüzlüğü yüksek kişilerde, aile veya partnerin ritüellere katılımı (güvence verme) OKB döngüsünün yakıtı mı?</p>
                    <div class="bg-slate-50 p-3 rounded text-xs text-slate-500 font-mono">
                        IU × Aile Uyumlaması (FAS) → Semptom Sürdürümü
                    </div>
                    <div class="mt-4 flex gap-2">
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Lebowitz (2015)</span>
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Albert (2017)</span>
                    </div>
                </div>

                <!-- Hypothesis C -->
                <div class="bg-white rounded-xl border-l-4 border-amber-500 p-6 shadow-sm card-hover">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-amber-900">Fikir C: ACT Süreçleri (Bilişsel Esneklik)</h3>
                        <span class="bg-amber-50 text-amber-700 text-xs px-2 py-1 rounded-full font-bold">Mekanizma</span>
                    </div>
                    <p class="text-slate-600 text-sm mb-4">Bilişsel füzyon (düşünceyle birleşme) ve yaşantısal kaçınma, IU ile OKB arasındaki ilişkiyi açıklayan "nasıl" sorusunun cevabı mı?</p>
                    <div class="bg-slate-50 p-3 rounded text-xs text-slate-500 font-mono">
                        IU → Füzyon/Kaçınma (AAQ-II) → OKB
                    </div>
                    <div class="mt-4 flex gap-2">
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Twohig (2010)</span>
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Frontiers (2021)</span>
                    </div>
                </div>

                <!-- Hypothesis D -->
                <div class="bg-white rounded-xl border-l-4 border-teal-500 p-6 shadow-sm card-hover">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-teal-900">Fikir D: �?efkat Temelli Köprü</h3>
                        <span class="bg-teal-50 text-teal-700 text-xs px-2 py-1 rounded-full font-bold">Yeni Nesil</span>
                    </div>
                    <p class="text-slate-600 text-sm mb-4">Bağlanma güvensizliği, "şefkat korkusu" (kendine veya başkasına) yaratarak mı OKB şiddetini etkiliyor?</p>
                    <div class="bg-slate-50 p-3 rounded text-xs text-slate-500 font-mono">
                        Güvensiz Bağlanma → �?efkat Korkusu → OKB
                    </div>
                    <div class="mt-4 flex gap-2">
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">McNeil (2025)</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- LIBRARY SECTION -->
        <section id="library" class="hidden-section fade-in space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-end gap-4 bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                <div class="max-w-xl">
                    <h2 class="text-2xl font-serif font-bold text-slate-800 mb-2">Dijital Kaynakça</h2>
                    <p class="text-slate-500 text-sm">Tez için seçilen 19 temel kaynak. Tüm makaleler Açık Erişim (Open Access) statüsündedir.</p>
                </div>
                <div class="flex flex-wrap gap-2 w-full md:w-auto">
                    <select id="catFilter" class="bg-slate-50 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-teal-500 focus:border-teal-500 outline-none w-full md:w-40">
                        <option value="all">Tüm Konular</option>
                        <option value="IU & OKB">IU ve OKB</option>
                        <option value="Ruminasyon">Ruminasyon</option>
                        <option value="Bağlanma">Bağlanma</option>
                        <option value="Aile">Aile Dinamikleri</option>
                        <option value="ACT">ACT / Süreç</option>
                    </select>
                    <input type="text" id="libSearch" placeholder="Yazar, yıl veya başlık ara..." class="bg-slate-50 border border-slate-300 rounded-lg px-4 py-2 text-sm w-full md:w-64 focus:ring-teal-500 focus:border-teal-500 outline-none">
                    <button id="exportSourcesBtn" class="bg-teal-600 hover:bg-teal-700 text-white rounded-lg px-4 py-2 text-sm font-medium transition w-full md:w-auto">Dışa Aktar</button>
                    <button id="importSourcesBtn" class="bg-slate-700 hover:bg-slate-800 text-white rounded-lg px-4 py-2 text-sm font-medium transition w-full md:w-auto">İçe Aktar</button>
                    <input id="importSourcesInput" type="file" accept=".json,.csv" class="hidden">
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider w-1/2">Makale Başlığı</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Yazar & Yıl</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Kategori</th>
                                <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">Erişim</th>
                            </tr>
                        </thead>
                        <tbody id="libraryTableBody" class="divide-y divide-slate-200 bg-white">
                            <!-- Injected by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="text-center text-xs text-slate-400 mt-4">
                *Linkler PubMed, Frontiers veya yayıncı sayfalarına yönlendirir. Çoğu "Full Text Free" butonuna sahiptir.
            </div>
        </section>

    </main>

    <script>
        // --- DATA: TEZ İÇİN SEÇİLMİ�? 19 KAYNAK ---
        let thesisSources = [
            // 1) IU & OKB
            { title: "Intolerance of uncertainty as a transdiagnostic cognitive vulnerability for obsessive-compulsive disorder and anxiety: A qualitative review", author: "Knowles et al. (2024)", category: "IU & OKB", url: "https://pubmed.ncbi.nlm.nih.gov/39431164/" },
            { title: "A meta-analysis of the relation of intolerance of uncertainty to symptoms of generalized anxiety disorder, major depressive disorder, and obsessive-compulsive disorder", author: "Gentes & Ruscio (2011)", category: "IU & OKB", url: "https://pubmed.ncbi.nlm.nih.gov/21664339/" },
            { title: "Intolerance of uncertainty: A common factor in the treatment of emotional disorders", author: "Boswell et al. (2013)", category: "IU & OKB", url: "https://pubmed.ncbi.nlm.nih.gov/23381685/" },
            { title: "Intolerance of uncertainty and obsessive-compulsive symptom expression", author: "Wheaton et al. (2020)", category: "IU & OKB", url: "https://doi.org/10.1016/j.janxdis.2020.102250" },

            // 2) Ruminasyon & OKB
            { title: "Mediating role of rumination and negative affect in the association between mind-wandering and obsessive-compulsive symptoms", author: "Wang et al. (2021)", category: "Ruminasyon", url: "https://doi.org/10.3389/fpsyt.2021.579663" },
            { title: "The relationship between sleep disturbance and obsessive-compulsive symptoms: mediation of repetitive negative thinking and experiential avoidance", author: "Zhao et al. (2023)", category: "Ruminasyon", url: "https://doi.org/10.3389/fpsyt.2023.1116272" },
            { title: "Repetitive negative thinking in obsessive-compulsive disorder: Evaluation of novel scenarios for cognitive bias modification training", author: "Hermida-Barros et al. (2025)", category: "Ruminasyon", url: "https://doi.org/10.1016/j.jbtep.2025.102037" },

            // 3) Bağlanma & OKB
            { title: "Attachment in obsessive-compulsive disorder: A meta-analysis", author: "van Leeuwen et al. (2020)", category: "Bağlanma", url: "https://doi.org/10.1080/10615806.2019.1648787" },
            { title: "Adult attachment and obsessive-compulsive symptoms: The mediating role of beliefs about losing control and intolerance of uncertainty", author: "Marsh et al. (2024)", category: "Bağlanma", url: "https://doi.org/10.1080/13284207.2024.2336962" },
            { title: "Attachment insecurity modulates neural responses to psychological distress in patients with obsessive-compulsive disorder and healthy individuals", author: "van Leeuwen et al. (2025)", category: "Bağlanma", url: "https://doi.org/10.1016/j.jad.2025.02.055" },
            { title: "Attachment insecurity, fear of compassion and obsessive-compulsive symptoms: A preliminary investigation", author: "McNeill et al. (2025)", category: "Bağlanma", url: "https://doi.org/10.1016/j.jbtep.2025.102046" },
            { title: "The efficacy of attachment-based family therapy with cognitive behavioral approach in reducing symptoms and parent-child conflicts in children with obsessive-compulsive disorder", author: "Nazarzadeh et al. (2013)", category: "Bağlanma", url: "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3939988/" },

            // 4) Aile Dinamikleri (Family Accommodation)
            { title: "Family accommodation in obsessive-compulsive and anxiety disorders: A five-year update", author: "Lebowitz et al. (2016)", category: "Aile", url: "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4895189/" },
            { title: "Family accommodation in obsessive-compulsive disorder: Clinical perspectives", author: "Albert et al. (2017)", category: "Aile", url: "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5449103/" },
            { title: "Predictors of parental accommodation in pediatric obsessive-compulsive disorder: Findings from the Pediatric OCD Treatment Study (POTS) trial", author: "Peris et al. (2012)", category: "Aile", url: "https://pubmed.ncbi.nlm.nih.gov/21703499/" },
            { title: "Obsessive beliefs, metacognitive beliefs and rumination in mothers of adolescents with obsessive-compulsive symptoms", author: "Misir et al. (2025)", category: "Aile", url: "https://doi.org/10.1002/cpp.3225" },

            // 5) ACT / Süreç
            { title: "A randomized clinical trial of acceptance and commitment therapy versus progressive relaxation training for obsessive-compulsive disorder", author: "Twohig et al. (2010)", category: "ACT", url: "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2936302/" },
            { title: "A systematic review and meta-analysis on the efficacy of acceptance and commitment therapy for obsessive-compulsive disorder", author: "Soondrum & Caltabiano (2022)", category: "ACT", url: "https://www.mdpi.com/2076-3425/12/5/656" },
            { title: "Cognitive fusion, experiential avoidance, and obsessive-compulsive symptoms in obsessive-compulsive disorder", author: "Hu et al. (2021)", category: "ACT", url: "https://doi.org/10.3389/fpsyg.2021.655154" }
        ];
        const dom = {
            libraryTableBody: document.getElementById('libraryTableBody'),
            libSearch: document.getElementById('libSearch'),
            catFilter: document.getElementById('catFilter'),
            exportSourcesBtn: document.getElementById('exportSourcesBtn'),
            importSourcesBtn: document.getElementById('importSourcesBtn'),
            importSourcesInput: document.getElementById('importSourcesInput')
        };
        const sections = Array.from(document.querySelectorAll('main > section'));
        const navItems = Array.from(document.querySelectorAll('.nav-item'));

        const categoryClassMap = Object.freeze({
            "IU & OKB": "bg-indigo-100 text-indigo-700",
            "Ruminasyon": "bg-blue-100 text-blue-700",
            "Bağlanma": "bg-teal-100 text-teal-700",
            "Aile": "bg-rose-100 text-rose-700",
            "ACT": "bg-amber-100 text-amber-700"
        });

        function buildPubMedSearchUrl(title) {
            return `https://pubmed.ncbi.nlm.nih.gov/?term=${encodeURIComponent(title)}`;
        }

        function resolveArticleUrl(item) {
            const rawUrl = (item.url || '').trim();
            if (!rawUrl || /^https?:\/\/www\.ncbi\.nlm\.nih\.gov\/pmc\/?$/i.test(rawUrl)) {
                return buildPubMedSearchUrl(item.title);
            }
            if (/^10\.\d{4,9}\//i.test(rawUrl)) {
                return `https://doi.org/${rawUrl}`;
            }
            return /^https?:\/\//i.test(rawUrl) ? rawUrl : `https://${rawUrl}`;
        }

        function escapeHtml(value) {
            return value
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#39;');
        }


        function extractYearFromAuthor(author) {
            const match = String(author || '').match(/\b(19|20)\d{2}\b/);
            return match ? match[0] : '';
        }

        function removeDuplicateSources(sources) {
            const seen = new Set();
            return sources.filter(item => {
                const titleKey = String(item.title || '').trim().toLowerCase();
                const urlKey = resolveArticleUrl(item).trim().toLowerCase();
                const yearKey = extractYearFromAuthor(item.author);
                const key = `${titleKey}|${urlKey}|${yearKey}`;
                if (seen.has(key)) {
                    return false;
                }
                seen.add(key);
                return true;
            });
        }

        function downloadTextFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const anchor = document.createElement('a');
            anchor.href = url;
            anchor.download = filename;
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
            URL.revokeObjectURL(url);
        }

        function exportSources() {
            const exportData = thesisSources.map(item => ({
                name: item.title,
                year: extractYearFromAuthor(item.author),
                link: resolveArticleUrl(item)
            }));
            downloadTextFile('makaleler.json', JSON.stringify(exportData, null, 2), 'application/json;charset=utf-8');
        }

        function parseCsvLine(line) {
            const cells = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i += 1) {
                const ch = line[i];
                const next = line[i + 1];
                if (ch === '"' && inQuotes && next === '"') {
                    current += '"';
                    i += 1;
                    continue;
                }
                if (ch === '"') {
                    inQuotes = !inQuotes;
                    continue;
                }
                if (ch === ',' && !inQuotes) {
                    cells.push(current.trim());
                    current = '';
                    continue;
                }
                current += ch;
            }
            cells.push(current.trim());
            return cells;
        }

        function mapImportRow(row) {
            const title = String(row.name || row.title || '').trim();
            const year = String(row.year || '').trim();
            const url = String(row.link || row.url || '').trim();
            const category = String(row.category || 'Diğer').trim() || 'Diğer';
            const author = String(row.author || `Import (${year || 'Yıl yok'})`).trim();

            if (!title || !url) {
                return null;
            }

            return { title, author, category, url };
        }

        function importFromJson(rawText) {
            const parsed = JSON.parse(rawText);
            const rows = Array.isArray(parsed) ? parsed : [parsed];
            const mapped = rows.map(mapImportRow).filter(Boolean);
            if (!mapped.length) {
                throw new Error('Geçerli kayıt bulunamadı. JSON içinde en az name/title ve link/url olmalı.');
            }
            thesisSources = removeDuplicateSources(mapped);
        }

        function importFromCsv(rawText) {
            const lines = rawText.split(/\r?\n/).map(line => line.trim()).filter(Boolean);
            if (lines.length < 2) {
                throw new Error('CSV dosyasında başlık satırı ve en az bir veri satırı olmalı.');
            }

            const headers = parseCsvLine(lines[0]).map(h => h.toLowerCase());
            const mapped = lines.slice(1).map(line => {
                const values = parseCsvLine(line);
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                return mapImportRow(row);
            }).filter(Boolean);

            if (!mapped.length) {
                throw new Error('Geçerli kayıt bulunamadı. CSV kolonları en az name/title ve link/url içermeli.');
            }

            thesisSources = removeDuplicateSources(mapped);
        }

        function handleImportFileChange(event) {
            const file = event.target.files && event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const rawText = String(reader.result || '');
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        importFromCsv(rawText);
                    } else {
                        importFromJson(rawText);
                    }
                    renderLibrary();
                    alert('İçe aktarma tamamlandı.');
                } catch (error) {
                    alert(`İçe aktarma hatası: ${error.message}`);
                } finally {
                    event.target.value = '';
                }
            };
            reader.readAsText(file, 'utf-8');
        }
        // --- NAVIGATION LOGIC ---
        function switchTab(tabId) {
            sections.forEach(sec => sec.classList.add('hidden-section'));
            document.getElementById(tabId).classList.remove('hidden-section');
            navItems.forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-${tabId}`).classList.add('active');
        }

        // --- LIBRARY LOGIC ---
        function renderLibrary() {
            const searchVal = dom.libSearch.value.trim().toLowerCase();
            const catVal = dom.catFilter.value;

            const filtered = thesisSources.filter(item => {
                const matchesSearch = item.title.toLowerCase().includes(searchVal) || item.author.toLowerCase().includes(searchVal);
                const matchesCat = catVal === 'all' || item.category === catVal;
                return matchesSearch && matchesCat;
            });

            if (filtered.length === 0) {
                dom.libraryTableBody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-slate-400">Aradığınız kriterlere uygun makale bulunamadı.</td></tr>';
                return;
            }

            dom.libraryTableBody.innerHTML = filtered.map(item => {
                const catClass = categoryClassMap[item.category] || "bg-slate-100 text-slate-600";
                const articleUrl = resolveArticleUrl(item);
                const title = escapeHtml(item.title);
                const author = escapeHtml(item.author);
                const category = escapeHtml(item.category);

                return `
                    <tr class="hover:bg-slate-50 transition-colors border-b border-slate-100 last:border-b-0">
                        <td class="px-6 py-4">
                            <a href="${articleUrl}" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-slate-800 hover:text-teal-700 hover:underline">
                                ${title}
                            </a>
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-500 font-mono">${author}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide ${catClass}">
                                ${category}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <a href="${articleUrl}" target="_blank" rel="noopener noreferrer" aria-label="${title} bağlantısını aç" class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-teal-50 text-teal-600 hover:bg-teal-100 hover:text-teal-800 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </a>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // --- CHARTS LOGIC ---
        function initCharts() {
            // Radar Chart (Kavramsal İlişki)
            const radarCtx = document.getElementById('radarChart').getContext('2d');
            new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: ['Belirsizliğe Tahammülsüzlük (IU)', 'Ruminasyon', 'Bağlanma Kaygısı', 'Aile Uyumlaması', 'Bilişsel Füzyon'],
                    datasets: [{
                        label: 'OKB �?iddetiyle İlişki Gücü (Temsili)',
                        data: [90, 85, 75, 70, 80],
                        backgroundColor: 'rgba(20, 184, 166, 0.2)', // Teal-500
                        borderColor: '#0d9488', // Teal-600
                        pointBackgroundColor: '#0f766e',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#0f766e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { display: false } // Hide numbers for cleaner look
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Doughnut Chart (Literatür Dağılımı)
            const doughnutCtx = document.getElementById('doughnutChart').getContext('2d');
            new Chart(doughnutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['IU & OKB', 'Ruminasyon', 'Bağlanma', 'Aile', 'ACT'],
                    datasets: [{
                        data: [4, 3, 5, 4, 3], // Based on the list count
                        backgroundColor: [
                            '#6366f1', // Indigo (IU)
                            '#3b82f6', // Blue (Rumination)
                            '#14b8a6', // Teal (Attachment)
                            '#f43f5e', // Rose (Family)
                            '#f59e0b'  // Amber (ACT)
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { usePointStyle: true, boxWidth: 8 }
                        }
                    }
                }
            });
        }

        // --- INIT EVENTS ---
        dom.libSearch.addEventListener('input', renderLibrary);
        dom.catFilter.addEventListener('change', renderLibrary);
        dom.exportSourcesBtn.addEventListener('click', exportSources);
        dom.importSourcesBtn.addEventListener('click', () => dom.importSourcesInput.click());
        dom.importSourcesInput.addEventListener('change', handleImportFileChange);

        window.addEventListener('DOMContentLoaded', () => {
            thesisSources = removeDuplicateSources(thesisSources);
            renderLibrary();
            initCharts();
        });
    </script>
</body>
</html>





